# 서블릿의 이해
---------------------
서블릿은 JSP의 기반 기술로 JSP와 마찬가지로 서블릿 컨테이너에 의해 실행되며 일반적인 자바 프로그램과 달리 정해진 규격에 따라 프로그래밍해야 함.'
## 1. 서블릿 개요

### 1.1 서블릿이란
서블릿 : 자바 플랫폼에서 컴포넌트를 기반으로 하는 웹 애플리케이션을 개발할 때 사용하는 핵심 기술, 내부적으로 JSP가 서블릿 형태로 변환되어 실행됨.

서블릿의 장점
1. 자바를 기반으로 하므로 자바 API를 모두 사용 가능
2. 운영체제나 하드웨어에 영향을 받지 않으므로, 한 번 개발된 애플리케이션은 다양한 서버 환경에서도 실행 가능
3. 웹 애플리케이션에서 효율적인 자료 공유 방법을 제공함
4. 다양한 오픈소스 라이브러리와 개발도구 활용 가능
5. 웹 애플리케이션을 개발할 때 사용하면
  -MVC 패턴을 쉽게 적용할 수 있고 컨테이너와 밀접한 서버 프로그램을 구현 가능  
  -MVC 패턴을 적용할 때 콘텐츠와 비즈니스 로직을 분리할 수 있으며 컨트롤러와 뷰가 역할을 분담함으로써, 웹 디자이너와 개발자 간에 작업을 원활하게 수행 가능  
  -리스너 및 필터 서블릿 등 고급 프로그래밍 기법을 통해 더욱 효과적인 웹 애플리케이션 설계 가능

### 1.2 서블릿과 서블릿 컨테이너
서블릿은 컨테이너라는 서버 소프트웨어에 의해 동작함.  
서블릿 컨테이너는 웹 서버와 마찬가지로 URL을 기반으로 한 요청에 따라 해당 서블릿을 실행함.  
JSP나 서블릿을 사용하지 않는 웹 프로그램 개발에는 웹 서버만 있으면 되지만, JSP나 서블릿으로 개발하려면 아파치 톰캣과 같은 서블릿 컨테이너가 필요함.

|구분|웹서버|서블릿컨테이너|  
|-----|---|---|
|사용목적|웹 서비스를 제공하기 위해 필요한 서버 기반의 소프트웨어|서블릿으로 개발된 자바 프로그램을 실행하고 처리하기 위한 서버 기반의 소프트웨어|
|처리 콘텐츠|HTML, CSS, JS, 이미지 파일 등|서블릿 클래스|
|실행 방법|콘텐츠가 위치한 URL 요청에 의해 실행하며 요청할 때마다 매번 디스크에서 읽어 처리|서블릿 클래스 정보에 따라 서버에 매핑된 URL 정보에 따라 실행하며 컨테이너에 적재된 상태에서 처리|
|JSP 실행|자체로 처리할 수 없음. 서블릿 컨테이너로 처리를 넘김.| JSP 자체로 처리할 수 있음.|
|특징| 웹 서비스 제공을 위한 다양한 설정을 제공하기 때문에 서버를 유연하게 운영하려면 웹 서버를 사용해야 함.|컨테이너에 따라 기본적인 웹 서버 기능을 내장하고 있으나 고급 설정이나 성능이 떨어지기 때문에 웹 서버와 병행해서 사용할 것을 권장함. |

### 1.3 서블릿 동작 과정
서블릿은 실행될 때 정해진 생명주기를 따르며, 각 생명주기 과정에는 특정한 이벤트와 상태가 존재함.
1. 개발자가 작성 한 소스가 컴파일 과정을 거쳐 서블릿을 컨테이너에 적재됨(등록).
2. 서블릿 클래스의 생성자 메서드를 호출해서 인스턴스를 생성함.
3. 생성된 인스턴스의 init() 메서드가 호출됨. init() 메서드는 서블릿 생명주기에서 단 한번만 실행되어 각종 초기화작업을 수행함.
4. 서블릿에 대한 사용자 요청에 대해 web.xml 파일 혹은 어노테이션을 참조해서 URL 매핑을 확인하고, 해당 서블릿 인스턴스로부터 스레드를 생성하고 service() 메서드가 호출되며 데이터베이스 연동 등 필요한 작업을 수행하고 처리 결과를 사용자에게 HTML 형식으로 전달함.
5. 이후 GET/POST에 대해 doGet()이나 doPost() 등의 메소드가 호출됨. 따라서 서블릿 개발자는 이들 메서드에 필요한 기능을 구현하게 됨.
6. 서블릿이 종료될 때는 destroy() 메서드가 호출됨.함.
7. 이후 사용자 요청에 따라 스레드 단위로 실행되면서 데이터베이스 연동 등 필요한 작업을 수행하고 처리 결과를 사용자에게 HTML 형식으로 전달함.

웹의 기본이 되는 HTTP 프로토콜의 규격으로 사용자가 웹 서버에 요청하는 방식  
-GET : 서버의 자원(HTML, 이미지 등)을 사용자가 요청하는 것
(http://www.hanbit.co.kr/index.html 이라는 브라우저 요청은 HTTP 프로토콜에서 GET / index.html과 같이 서버로 전달됨.)  
서버에 최대 240Byte의 데이터 전달 가능.   
QUERY_STRING 환경변수를 통해서 서버로 전달됨.  
(http://www.xxx.co.kr/servlet/login?id=hj&name=hong)  
'?' 이후의 값들은 서버에서 QUERY_STRING을 통해 전달됨.   
'속성=값' 형태로 사용해야 하며 '&'는 여러 속성 값을 전달할 때 연결해주는 문자열.  
URL이 노출되기 때문에 보안에 문제 발생 가능.  
doGet() 메서드로 요청 처리

-POST : 로그인/회원가입(HTML 폼) 등 브라우저에서 사용자가 입력한 데이터를 서버에 보내는 방식
서버에 전달할 수 있는 데이터 크기에 제한 없음.
URL에 매개변수가 표시되지 않음.
doPost() 메서드로 요청 처리


-HEAD,DELETE,OPTIONS,TRACE와 같은 요청이 정의되어 doHead(), doDelete(), doOptions(), doTrace() 메서드를 통해 요청을 처리할 수 있지만 웸 애플리케이션 개발에는 거의 사용하지 않음.

## 2. 서블릿 구조와 생명주기
JSP와 달리 서블릿은 일반적인 자바 클래스 구조로 컴파일 과정이 필요하고 특정 클래스를 상속 받아야만 구현할 수 있는 구조. 
### 2.1 서블릿 구조와 API
API : Application Programming Interface 특정 클래스를 다른 프로그램에서 사용하려고 필요한 정보를 규격화해놓은 것
자바 서블릿 API는 서블릿과 서버 사이의 인터페이스를 정의함

모든 서블릿은 javax.servlet.Servlet 인터페이스를 구현해야 하지만 일반적으로 미리 정의된 javax.servlet.GenericServlet과 javax.servlet.http.HttpServlet클래스 중 하나를 상속해서 구현함. HttpServlet은 GenericServlet의 하위 클래스로서, HTTP 처리와 관련된 부가 기능이 추가된 구조.

### 2.2 서블릿 생명 주기
1. 서블릿 초기화 : init() 메서드  
   클라이언트 요청이 들어오면 컨테이너는 해당 서블릿이 메모리에 있는지 확인함. 해당 서블릿이 메모리에 없을 경우 다시 적재해야 하는데, 이때 서블릿의 init() 메서드가 호출되어 각종 초기화 작업을 수행함. init() 메서드를 오버라이딩하여 해당 서블릿에 각각의 스레드에서 공통적으로 사용하기 위해 필요한 작업을 구현 가능. 
   실행 중 서블릿이 변경될 경우에는 기존 서블릿은 종료되고 새로운 내용을 다시 적재하기 위해 init() 메서드가 호출됨

2. 요청/응답 : service() 메서드  
   init() 메서드는 최초 수행 이후 요청은 스레드로 실행되며,각각 service()메서드를 통해 doGet() 또는 doPost() 로 분기됨. 파라미터로 HttpServlerRequest 와 HttpServletResponse 클래스 타입인 request 와 response 객체가 제공되는데, 사용자 요청 처리는 request로, 응답 처리를 response 객체로 처리

3. 서블릿 종료 : destroy() 메서드  
   컨테이너로부터 서블릿 종료 요청이 있을 때(대부분의 경우 컨테이너가 종료될 때지만 컨테이너는 실행된 상태에서 특정 서블릿을 로드/언로드 가능) destory() 메서드를 호출. init() 메서드와 동일하게 한 번만 실행되며,  destroy() 메서드를 오버라이딩하여 서블릿이 종료되면서 정리해야 할 작업을 구현 가능.




